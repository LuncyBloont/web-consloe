<!DOCTYPE html>
<html>
<head>
    <script src="js/console.js"></script>
    <script>
cmd = new ConsoleForUser("@ ");
    </script>
</head>
<body>
    <pre>
        <div rows="40" id="tx" style="width: 95% ; font-size: 16pt; padding: 0.5cm; font-family: 'Courier New', Courier, monospace;"></div>
    </pre>
    <textarea style="z-index: 10; top:0%; left: 0%; position: fixed; width: 100%; height: 1000%; opacity: 0.1;"></textarea>
    <script>
document.body.onkeydown = function(e) {
    var event = e || event || window.event;
    event.preventDefault();
    event.returnValue = false;
    cmd.input(event.keyCode);
    cmd.shift_test_down(event.keyCode);
};

document.body.onkeyup = function() {
    event.preventDefault();
    event.returnValue = false;
    cmd.shift_test_up(event.keyCode);
};

document.getElementById("tx").ontouchstart = function() {
    if (!window.OnKey) {
        window.OnKey = function() {
            var a = document.getElementById("tx").value;
            document.getElementById("tx").value = "";
            cmd.get_in(a);
        };
        setInterval(window.OnKey, 30);
    }    
    // document.body.onkeydown = function() {}
    // document.body.onkeyup = function() {}
};

cmd.help_string += "\nDemo help:\n\
  echo \"<string>\"            \tprint message on console.\n\
  run \"[code]\"               \trun js code in this page.\n\
  alert \"<string>\"           \talert message use browser alert components.\n\
  help                         \tshow help doc.\n";
cmd.super_run = cmd.run;
cmd.run = function(cmd) {
    var sr = this.super_run(cmd);
    var cmds = (cmd + "").split(" ");
    if (cmds[0] == "echo") {
        var s = cmd.substring(cmd.indexOf("echo") + 5, cmd.length);
        try {
            if (s.indexOf("\"") < 0) {
                var a = undefined;
                a.replace();
            }
            s = eval(s);
        } catch {
            this.print(this.getString("string should be included by \"\" ..."));
            return "(x)"
        }
        s = this.getString(s);
        this.print(s, true);
        return "(OK)";
    }
    if (cmds[0] == "run") {
        var s = cmd.substring(cmd.indexOf("run") + 4, cmd.length);
        try {
            if (s.indexOf("\"") < 0) {
                var a = undefined;
                a.replace();
            }
            s = eval(s);
            s = eval(s);
        } catch {
            this.print(this.getString("code should be included by \"\" ..."));
            return "(x)";
        }
        s = this.getString(s) + this.endl;
        this.print(s);
        return "(OK)";
    }
    if (cmds[0] == "alert") {
        var s = cmd.substring(cmd.indexOf("alert") + 6, cmd.length);
        try {
            if (s.indexOf("\"") < 0) {
                var a = undefined;
                a.replace();
            }
            s = eval(s);
            alert(s);
        } catch {
            this.print(this.getString("string should be included by \"\" ..."));
            return "(x)";
        }
        return "(OK)";
    }
    return sr == true ? true : "(?)";
};

function update() {
    document.getElementById("tx").innerHTML = cmd.toShow();
    document.getElementById("tx").scrollIntoView(false);
}

setInterval(update, 10);
cmd.start();

    </script>
</body>
</html>